<!doctype html><html lang="th"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Admin Dashboard ‚Äî AiAm practice exam online</title>
<style>
body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;margin:0;background:#f8fafc;color:#0f172a}
header{background:linear-gradient(135deg,#0b74da,#3aa0ff);color:#fff;padding:18px 24px;text-align:center;font-size:22px;font-weight:700}
main{max-width:1100px;margin:28px auto;padding:0 16px}
.card{background:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(11,37,71,.06);padding:16px;margin-bottom:16px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
.kpi h3{margin:0;color:#64748b;font-size:13px} .kpi .v{font-size:24px;font-weight:800;margin-top:6px;color:#0b74da}
.table{overflow:auto} table{width:100%;border-collapse:collapse} th,td{text-align:left;padding:10px 12px;border-bottom:1px solid #e2e8f0} th{background:#f1f5f9;color:#334155}
.badge{background:#e2e8f0;color:#334155;border-radius:999px;padding:6px 10px;font-size:12px}
.chart{height:220px}
</style></head>
<body>
<header>üß≠ AiAm practice exam online ‚Äî Admin Dashboard</header>
<main>
  <div class="grid">
    <div class="card kpi"><h3>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3><div class="v" id="k_total">0</div></div>
    <div class="card kpi"><h3>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (%)</h3><div class="v" id="k_avg">0</div></div>
    <div class="card kpi"><h3>‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö (‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥)</h3><div class="v" id="k_users">0</div></div>
    <div class="card kpi"><h3>‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3><div class="v" id="k_today">0</div></div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px;">Top Tests by Attempts</h3>
    <div id="bar" class="chart"></div>
  </div>

  <div class="card table">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h3 style="margin:0;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
      <span class="badge" id="countBadge">0 records</span>
    </div>
    <table id="t">
      <thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ó‡∏≥</th><th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th><th>‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå</th><th>‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th></tr></thead>
      <tbody><tr><td colspan="5">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr></tbody>
    </table>
  </div>
</main>

<script type="module">
const firebaseConfig={apiKey:"YOUR_API_KEY",authDomain:"YOUR_AUTH_DOMAIN",projectId:"YOUR_PROJECT_ID",storageBucket:"YOUR_BUCKET",messagingSenderId:"YOUR_SENDER_ID",appId:"YOUR_APP_ID"};
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const tbody = document.querySelector("#t tbody");
const badge = document.getElementById("countBadge");
const k_total = document.getElementById("k_total");
const k_avg = document.getElementById("k_avg");
const k_users = document.getElementById("k_users");
const k_today = document.getElementById("k_today");
const bar = document.getElementById("bar");

function drawBar(data) {
  const max = Math.max(1, ...data.map(d=>d[1]));
  const bars = data.map(d=>{
    const w = Math.round(d[1]/max*100);
    return `<div style="display:flex;align-items:center;margin:6px 0;">
      <div style="width:140px;font-size:12px;color:#475569;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${d[0]}</div>
      <div style="flex:1;background:#e2e8f0;height:10px;border-radius:999px;margin:0 8px;overflow:hidden;">
        <i style="display:block;height:10px;width:${w}%;background:linear-gradient(90deg,#0b74da,#38bdf8);"></i>
      </div>
      <div style="width:30px;text-align:right;font-weight:700;color:#0b74da">${d[1]}</div>
    </div>`;
  }).join("");
  bar.innerHTML = bars || "<div style='color:#64748b'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠</div>";
}

function isToday(ts) {
  if(!ts?.toDate) return false;
  const d = ts.toDate();
  const t = new Date();
  return d.getFullYear()===t.getFullYear() && d.getMonth()===t.getMonth() && d.getDate()===t.getDate();
}

onSnapshot(query(collection(db, "results"), orderBy("createdAt","desc")), (snap)=>{
  if (snap.empty) {
    tbody.innerHTML = "<tr><td colspan='5'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</td></tr>";
    badge.textContent = "0 records";
    k_total.textContent = "0";
    k_avg.textContent = "0";
    k_users.textContent = "0";
    k_today.textContent = "0";
    drawBar([]);
    return;
  }
  const rows = [];
  let total=0, avgSum=0, todayCount=0;
  const users = new Set();
  const testCount = new Map();

  snap.forEach(doc=>{
    const d = doc.data();
    users.add(d.name||"-");
    total++;
    avgSum += (d.percent||0);
    if(isToday(d.createdAt)) todayCount++;
    const tname = d.testId||"-";
    testCount.set(tname, (testCount.get(tname)||0)+1);

    const date = d.createdAt?.toDate ? d.createdAt.toDate().toLocaleString("th-TH", { dateStyle:"medium", timeStyle:"short" }) : "-";
    rows.push(`<tr><td>${d.name||"-"}</td><td class='score'>${d.score}/${d.total}</td><td class='percent'>${d.percent}%</td><td>${tname}</td><td>${date}</td></tr>`);
  });

  tbody.innerHTML = rows.join("");
  badge.textContent = total + " records";
  k_total.textContent = total.toString();
  k_avg.textContent = Math.round(avgSum/total) + "%";
  k_users.textContent = users.size.toString();
  k_today.textContent = todayCount.toString();

  const top = Array.from(testCount.entries()).sort((a,b)=>b[1]-a[1]).slice(0,6);
  drawBar(top);
});
</script>
</body></html>