<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö | AiAm practice exam online</title>
  <style>
    :root{--bg:#f5f9ff;--card:#ffffff;--accent:#0b74da;--muted:#6b7280;--success:#16a34a;--danger:#dc2626}
    *{box-sizing:border-box}
    body{font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; background:var(--bg); color:#0f172a}
    header{background:#0b74da;color:#fff;padding:18px;text-align:center;font-weight:700}
    .wrap{max-width:880px;margin:28px auto;padding:20px}
    .card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 6px 20px rgba(11,37,71,0.06)}
    .progress{height:10px;background:#e6eefc;border-radius:999px;overflow:hidden;margin:12px 0}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#38bdf8);width:0}
    .qnum{font-weight:600;color:var(--accent)}
    .question{margin:8px 0 16px;font-size:18px}
    .choices{display:flex;flex-direction:column;gap:10px}
    .choice{border:1px solid #e6eefc;padding:12px;border-radius:10px;cursor:pointer;display:flex;align-items:center;gap:12px}
    .choice input{accent-color:var(--accent)}
    .controls{display:flex;justify-content:space-between;gap:12px;margin-top:16px}
    button{background:var(--accent);color:#fff;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    button.ghost{background:transparent;color:var(--accent);border:1px solid #e6eefc}
    button:disabled{opacity:.5;cursor:not-allowed}
    .result{padding:14px;border-radius:10px;margin-top:14px}
    .score{font-size:20px;font-weight:700}
    .correct{color:var(--success);font-weight:700}
    .incorrect{color:var(--danger);font-weight:700}
    footer.small{margin-top:18px;color:var(--muted);font-size:13px}
    .meta{display:flex;gap:8px;align-items:center;margin:8px 0 12px;color:var(--muted)}
    input[type=text]{padding:10px;border:1px solid #e6eefc;border-radius:10px;width:100%}
  </style>
</head>
<body>
  <header>‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö ‚Äî AiAm practice exam online</header>
  <div class="wrap">
    <main class="card" id="app">
      <div class="meta">
        <label for="username">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ó‡∏≥: </label>
        <input id="username" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà" />
        <button id="startBtn" class="ghost">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
      </div>

      <div class="progress" aria-hidden><i id="progressBar"></i></div>
      <div id="questionArea"></div>

      <div class="controls">
        <button class="ghost" id="prevBtn" disabled>Previous</button>
        <button id="nextBtn" disabled>Next</button>
      </div>

      <div id="finalArea"></div>
    </main>
    <footer class="small" style="text-align:center">¬© 2025 AiAm practice exam online ‚Äî ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firebase</footer>
  </div>

  <script type="module">
    // ‚úÖ ‡∏ß‡∏≤‡∏á firebaseConfig ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentUser = null;
    signInAnonymously(auth).catch(console.error);
    onAuthStateChanged(auth, (user)=>{ currentUser = user; });

    // ‡∏≠‡πà‡∏≤‡∏ô test id ‡∏à‡∏≤‡∏Å‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå
    const params = new URLSearchParams(window.location.search);
    const testId = params.get("test") || "toeic-set1";

    // ‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ï‡∏≤‡∏° testId
    const BANK = {
      "toeic-set1": [
        {q:"The company will __________ the new software next month.", choices:["launch","launched","be launching","launches"], answer:0, expl:"will + V1 ‚Üí launch = ‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß"},
        {q:"She has been working here _____ 2018.", choices:["for","since","from","in"], answer:1, expl:"since + ‡∏à‡∏∏‡∏î‡πÄ‡∏ß‡∏•‡∏≤ (2018) / for + ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤"},
        {q:"If you have any questions, please _____ to contact our support team.", choices:["feel free","feel","to feel","feel it"], answer:0, expl:"‡∏™‡∏≥‡∏ô‡∏ß‡∏ô feel free to + V (‡πÄ‡∏ä‡∏¥‡∏ç‡∏ï‡∏≤‡∏°‡∏™‡∏ö‡∏≤‡∏¢)"},
        {q:"The meeting will be held _____ the conference room on the second floor.", choices:["in","at","on","over"], answer:1, expl:"‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á‡∏ô‡∏¥‡∏¢‡∏°‡πÉ‡∏ä‡πâ at"},
        {q:"By the time the manager arrives, we _____ finished the report.", choices:["will have","have","had","will be"], answer:0, expl:"Future perfect: will have + V3"},
        {q:"The shipment was delayed due to _____ weather conditions.", choices:["inclement","inclined","including","incomplete"], answer:0, expl:"inclement = ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏•‡∏ß‡∏£‡πâ‡∏≤‡∏¢"},
        {q:"He _____ in three different countries during his career.", choices:["lived","has lived","will live","is living"], answer:1, expl:"Present perfect ‚Üí has lived"},
        {q:"She gave _____ excellent presentation yesterday.", choices:["a","an","the","no article"], answer:1, expl:"‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏£‡∏∞ (excellent) ‚Üí an"},
        {q:"The CEO wanted to cut costs; _____, they postponed the project.", choices:["therefore","however","moreover","in fact"], answer:1, expl:"however = ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£‡∏Å‡πá‡∏ï‡∏≤‡∏° (‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á)"},
        {q:"Please ensure all employees _____ the safety procedures before starting.", choices:["familiarize","are familiar with","familiarized","will be familiar"], answer:1, expl:"are familiar with = ‡∏Ñ‡∏∏‡πâ‡∏ô‡πÄ‡∏Ñ‡∏¢"},
        {q:"The policy applies _____ all full-time staff.", choices:["for","to","with","on"], answer:1, expl:"apply to + ‡∏ú‡∏π‡πâ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ"},
        {q:"Neither the manager nor the assistants _____ available today.", choices:["is","are","were","be"], answer:1, expl:"‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏∏‡∏î assistants ‚Üí are"},
        {q:"The revised schedule _____ published on Monday.", choices:["was","were","is","are"], answer:0, expl:"schedule ‡πÄ‡∏≠‡∏Å‡∏û‡∏à‡∏ô‡πå + passive ‡∏≠‡∏î‡∏µ‡∏ï ‚Üí was published"},
        {q:"He recommended _____ the contract before signing.", choices:["to review","reviewing","review","to reviewing"], answer:1, expl:"recommend + V-ing"},
        {q:"They offered him a position _____ marketing manager.", choices:["as","to be","for","in"], answer:0, expl:"as + ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"},
        {q:"The report provides a _____ analysis of market trends.", choices:["comprehensive","comprehend","comprehending","comprehension"], answer:0, expl:"‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ adj. ‚Üí comprehensive"},
        {q:"If she _____ earlier, she would have caught the train.", choices:["had left","left","would leave","leaves"], answer:0, expl:"‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà 3 ‚Üí had + V3"},
        {q:"They insisted that the meeting _____ moved to next week.", choices:["be","is","was","will be"], answer:0, expl:"subjunctive ‚Üí be moved"},
        {q:"The new software is more _____ than the previous version.", choices:["user-friendly","user friendlier","more user friendly","user-friendlyer"], answer:0, expl:"‡∏£‡∏π‡∏õ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á user-friendly"},
        {q:"The team was praised _____ their outstanding performance.", choices:["for","with","by","to"], answer:0, expl:"praised for + ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ä‡∏°"}
      ],
      "pakor-set1": [
        {q:"‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô _______ ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏≤‡∏ï‡∏¥‡πÑ‡∏ó‡∏¢", choices:["‡∏†‡∏≤‡∏©‡∏≤","‡∏®‡∏≤‡∏™‡∏ô‡∏≤","‡πÄ‡∏û‡∏•‡∏á","‡∏ò‡∏á"], answer:0, expl:"‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏≤‡∏ï‡∏¥ ‡πÄ‡∏ä‡πà‡∏ô ‡∏†‡∏≤‡∏©‡∏≤ ‡∏®‡∏≤‡∏™‡∏ô‡∏≤ ‡∏û‡∏£‡∏∞‡∏°‡∏´‡∏≤‡∏Å‡∏©‡∏±‡∏ï‡∏£‡∏¥‡∏¢‡πå ‡∏Ø‡∏•‡∏Ø"},
        {q:"‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞", choices:["21","31","33","35"], answer:1, expl:"31 ‡∏´‡∏≤‡∏£‡∏•‡∏á‡∏ï‡∏±‡∏ß‡∏î‡πâ‡∏ß‡∏¢ 1 ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô"},
        {q:"‡∏û‡∏±‡∏ô‡∏ò‡∏Å‡∏¥‡∏à‡∏Ç‡∏≠‡∏á ‡∏Å.‡∏û. ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡πÉ‡∏î", choices:["‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á","‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏ô‡∏†‡∏≤‡∏Ñ‡∏£‡∏±‡∏ê","‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á","‡πÄ‡∏Å‡∏©‡∏ï‡∏£"], answer:1, expl:"‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‡∏Å.‡∏û. ‡∏î‡∏π‡πÅ‡∏•‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏ô‡∏†‡∏≤‡∏Ñ‡∏£‡∏±‡∏ê"},
        {q:"‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡∏™‡∏∞‡∏Å‡∏î‡∏ñ‡∏π‡∏Å", choices:["‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏Å‡∏£","‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏Å‡∏≤‡∏£","‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£","‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å"], answer:2, expl:"‡∏™‡∏∞‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£"},
        {q:"‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ç‡∏≠‡∏á‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 2, 4, 6, 8 ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÉ‡∏î", choices:["4","5","6","7"], answer:1, expl:"(2+4+6+8)/4 = 5"}
      ]
    };

    const QUESTIONS = BANK[testId] || BANK["toeic-set1"];

    // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
    let current = 0;
    const answers = Array(QUESTIONS.length).fill(null);
    let userName = "";

    // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á element
    const progressBar = document.getElementById('progressBar');
    const questionArea = document.getElementById('questionArea');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const startBtn = document.getElementById('startBtn');
    const usernameInput = document.getElementById('username');
    const finalArea = document.getElementById('finalArea');

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
    startBtn.addEventListener('click', ()=>{
      const name = usernameInput.value.trim();
      if(!name){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö'); return; }
      userName = name;
      prevBtn.disabled = false;
      nextBtn.disabled = false;
      startBtn.disabled = true;
      usernameInput.disabled = true;
      renderQuestion(current);
    });

    function renderQuestion(i){
      const item = QUESTIONS[i];
      progressBar.style.width = (i/QUESTIONS.length*100+5) + '%';

      questionArea.innerHTML = `
        <div>
          <div class="qnum">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${i+1} ‡∏à‡∏≤‡∏Å ${QUESTIONS.length}</div>
          <div class="question">${item.q}</div>
          <div class="choices">
            ${item.choices.map((ch, idx)=>
              `<label class='choice'>
                <input type='radio' name='choice' value='${idx}'> ${String.fromCharCode(65+idx)}. ${ch}
              </label>`).join('')}
          </div>
          <div id='feedback' style='margin-top:12px;font-weight:600;'></div>
          <div id='explanation' style='margin-top:6px;color:#64748b;'></div>
        </div>`;

      prevBtn.disabled = i===0;
      nextBtn.textContent = (i===QUESTIONS.length-1)? 'Finish' : 'Next';

      document.querySelectorAll('input[name=choice]').forEach((el,idx)=>{
        el.addEventListener('change',()=>{
          answers[i]=idx;
          const fb=document.getElementById('feedback');
          const ex=document.getElementById('explanation');
          if(idx===item.answer){
            fb.innerHTML = '<span class="correct">‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</span>';
          } else {
            fb.innerHTML = `<span class="incorrect">‚ùå ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</span> (‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å: <strong>${String.fromCharCode(65+item.answer)}. ${item.choices[item.answer]}</strong>)`;
          }
          ex.innerHTML = '‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢: '+item.expl;
        });
      });
    }

    prevBtn.addEventListener('click', ()=>{ if(current>0){ current--; renderQuestion(current); } });
    nextBtn.addEventListener('click', ()=>{ if(current<QUESTIONS.length-1){ current++; renderQuestion(current); } else { showResults(); } });

    async function showResults(){
      let correct=0;
      QUESTIONS.forEach((q,i)=>{ if(answers[i]===q.answer) correct++; });
      const percent = Math.round(correct/QUESTIONS.length*100);

      finalArea.innerHTML = `
        <div class='result'>
          <div class='score'>üéâ Congratulations! You‚Äôve finished the test.</div>
          <div class='score'>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${correct} / ${QUESTIONS.length} (${percent}%)</div>
          <div style='margin-top:6px;color:#64748b'>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á Firebase...</div>
        </div>`;
      finalArea.scrollIntoView({behavior:'smooth'});

      try {
        if(!currentUser) throw new Error('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô');
        await addDoc(collection(db, "results"), {
          name: userName,
          score: correct,
          total: QUESTIONS.length,
          percent: percent,
          testId,
          createdAt: serverTimestamp(),
          uid: currentUser.uid
        });
      } catch(err) {
        console.error(err);
        finalArea.innerHTML += `<div style='margin-top:8px;color:#dc2626'>‚ö†Ô∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${err.message}</div>`;
      }
    }
  </script>
</body>
</html>
